<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
    <script src="http://learning-fuze.github.io/memory_match/v0.1/script.js"></script>
    <script>
        var count = 1;
        var clickCount = 0;
        var first_card_clicked = null;
        var second_card_clicked = null;
        var total_possible_matches = 2;
        var match_counter = 0;
        var games_played = 0;


        $(document).ready(function(){
            $('.flipped').off('click');
            function card_clicked(){
                $('.container').click(function() {
                    $(this).find('.flip').addClass('flipped');

                    if(first_card_clicked === null){
                        first_card_clicked = $(this).find('.back').css('background-image');
                    }
                    else{
                        second_card_clicked = $(this).find('.back').css('background-image');

                    }
                    clickCount++;
                    if (clickCount % 2 === 0) {
                        $('.attempt .value').text(count++);
                        checkMatch();
                        $('.accuracy .value').html((((match_counter)/(clickCount/2))*100).toFixed(0) + "%");

                    }
                })
            }
            function cardDefault(){
                first_card_clicked = null;
                second_card_clicked = null;
            }
            function flipBack() {
                $('.flipped').filter(function () {
                    var back = $(this).find('.back');
                    var source = back.css('background-image');
                    return source === first_card_clicked || source === second_card_clicked;
                }).removeClass('flipped');
                cardDefault();

            }
            function checkMatch(){
                if(first_card_clicked === second_card_clicked && match_counter < 8 ){
                    setTimeout(function(){ alert("They Match!"); }, 400);
                    match_counter++;
                    cardDefault();

                }
                else if (first_card_clicked !== second_card_clicked) {
                    setTimeout(function () {
                        alert("They Don't Match!");
                    }, 400);
                    setTimeout(flipBack, 1000);
                    //add off click handler and reapply?
                }
                else {
                    setTimeout(function(){ alert("You Win!!!"); }, 400);
                    games_played++;
                    $('.games-played .value').text(games_played);
                }
            }



            function resetGame() {
                $('#reset').click(function () {
                    $('.flipped').removeClass('flipped');
                    $('.attempt .value').html("");
                    $('.accuracy .value').html("");
                    count=1;
                    clickCount=0;
                    first_card_clicked = null;
                    second_card_clicked = null;
                });
            }
            card_clicked()
            resetGame();
        });


    </script>
</head>
<body>
    <div id="header">
        <a href="">Settings</a>
        <a href="about.html">About</a>
        <img src="images/dark_souls_banner.jpg" id="banner">

    </div>
    <div id="stats">
        <div class="games-played">
            <h2 class="label">Games Played</h2>
            <div class="value"></div>
        </div>
        <div class="attempt">
            <div class="label">Attempts:</div>
            <div class="value"></div>
        </div>
        <div class="accuracy">
            <div class="label">Accuracy:</div>
            <div class="value"></div>
        </div>
        <img src="images/bonfire.jpg" id="reset">
    </div>
    <div id="row_container">
        <div class="row_health">
            <div id="health"></div>
            <div id="stamina"></div>
        </div>
        <div class="row">
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/lady_maria.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/artorias.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/Brador.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/Eileen.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/artorias.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/Brador.jpg);"></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/Iosefka.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/Iosefka.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/lady_maria.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/Eileen.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/Logan.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/quelaag.jpg);"></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/Oscar.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/quelaag.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/Ornstein.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/Oscar.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/Logan.jpg);"></div>
                </div>
            </div>
            <div class="container">
                <div class="flip">
                    <div class="face front"></div>
                    <div class="face back" style="background-image: url(images/Ornstein.jpg);"></div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>